<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Neucha:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="前端,react," />





  <link rel="alternate" href="/atom.xml" title="秋染蒹葭" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.0" />






<meta name="description" content="先放上原文链接 今年4、5月的杭州天气总是让人摸不着头脑，可能也是今年疫情的原因，似乎并没有太多春天的感觉；虽然温度是慢慢的升上来了，但感觉没有春天的那种万物复苏，到处鲜花盛开的感觉；不知道是今年疫情的原因，还是视线被俗事一叶障目，总之一切都不太像想象中的样子。闲话少叙吧，搬运一篇Martin Hochel的文章，开始吧">
<meta name="keywords" content="前端,react">
<meta property="og:type" content="article">
<meta property="og:title" content="【译】React Refs中使用TypeScript">
<meta property="og:url" content="https://zhyjor.github.io/2020/04/18/ReactRefs如何使用TypeScript/index.html">
<meta property="og:site_name" content="秋染蒹葭">
<meta property="og:description" content="先放上原文链接 今年4、5月的杭州天气总是让人摸不着头脑，可能也是今年疫情的原因，似乎并没有太多春天的感觉；虽然温度是慢慢的升上来了，但感觉没有春天的那种万物复苏，到处鲜花盛开的感觉；不知道是今年疫情的原因，还是视线被俗事一叶障目，总之一切都不太像想象中的样子。闲话少叙吧，搬运一篇Martin Hochel的文章，开始吧">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-18-034713.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-18-151348.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-18-153750.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-18-0_gzeeS5C5h2tBDbv4.gif">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-23-114502.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-23-120025.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-23-122405.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-23-122952.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-23-0_OWdwypfLrHqpjoq2.gif">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-24-020526.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-24-020706.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-24-023935.jpg">
<meta property="og:image" content="http://static.zhyjor.com/blog/2020-04-24-0_Rkp7RYK65NVE8-YB.gif">
<meta property="og:image" content="https://static.zhyjor.com/wexin.png">
<meta property="og:updated_time" content="2023-10-11T02:22:23.792Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【译】React Refs中使用TypeScript">
<meta name="twitter:description" content="先放上原文链接 今年4、5月的杭州天气总是让人摸不着头脑，可能也是今年疫情的原因，似乎并没有太多春天的感觉；虽然温度是慢慢的升上来了，但感觉没有春天的那种万物复苏，到处鲜花盛开的感觉；不知道是今年疫情的原因，还是视线被俗事一叶障目，总之一切都不太像想象中的样子。闲话少叙吧，搬运一篇Martin Hochel的文章，开始吧">
<meta name="twitter:image" content="http://static.zhyjor.com/blog/2020-04-18-034713.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zhyjor.github.io/2020/04/18/ReactRefs如何使用TypeScript/"/>





  <title> 【译】React Refs中使用TypeScript | 秋染蒹葭 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?340874ba9357cbe81570aa4ac1185941";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <a href="https://github.com/zhyjor"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

	<header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta custom-logo">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">秋染蒹葭</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <h1 class="site-subtitle" itemprop="description">会当凌绝顶，一览众山小</h1>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://zhyjor.github.io/2020/04/18/ReactRefs如何使用TypeScript/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="zhyjor">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="秋染蒹葭">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="秋染蒹葭" src="/images/avatar.jpg">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                【译】React Refs中使用TypeScript
              
            
          </h2>
        

        <div class="post-meta">
		
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-18T03:25:58+00:00">
                2020-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/04/18/ReactRefs如何使用TypeScript/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/04/18/ReactRefs如何使用TypeScript/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          
 
        


        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>先放上<a href="https://medium.com/@martin_hotell/react-refs-with-typescript-a32d56c4d315" target="_blank" rel="external">原文链接</a></p>
<p>今年4、5月的杭州天气总是让人摸不着头脑，可能也是今年疫情的原因，似乎并没有太多春天的感觉；虽然温度是慢慢的升上来了，但感觉没有春天的那种万物复苏，到处鲜花盛开的感觉；不知道是今年疫情的原因，还是视线被俗事一叶障目，总之一切都不太像想象中的样子。闲话少叙吧，搬运一篇Martin Hochel的文章，开始吧<br><a id="more"></a><br><img src="http://static.zhyjor.com/blog/2020-04-18-034713.jpg" alt=""></p>
<blockquote>
<p>文章使用以下版本</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"@types/react"</span>: <span class="string">"16.4.7"</span>,</div><div class="line">  <span class="attr">"@types/react-dom"</span>: <span class="string">"16.0.6"</span>,</div><div class="line">  <span class="attr">"typescript"</span>: <span class="string">"3.0.1"</span>,</div><div class="line">  <span class="attr">"react"</span>: <span class="string">"16.4.2"</span>,</div><div class="line">  <span class="attr">"react-dom"</span>: <span class="string">"16.4.2"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <a href="https://github.com/Hotell/blogposts/tree/master/2018-08/react-ts-refs" target="_blank" rel="external">源码地址</a></p>
<p> 经常会收到询问typescript中如何合适的定义react refs的类型的问题，我没有找到有人写过关于这个问题的资料，就写了这篇文章帮助那些新接触react和typescript的人。</p>
<blockquote>
<p>免职声明：<br> 这篇译文完全是凭自己兴趣翻译，详情请参考原文和<a href="https://reactjs.org/docs/refs-and-the-dom.html" target="_blank" rel="external">React Ref的官方文档</a></p>
</blockquote>
<h2 id="什么是Refs"><a href="#什么是Refs" class="headerlink" title="什么是Refs"></a>什么是Refs</h2><blockquote>
<p>Refs provide a way to access DOM nodes or React elements created in the render method.<br> Refs提供了一种在React中访问Dom节点的方式</p>
</blockquote>
<h2 id="创建Refs"><a href="#创建Refs" class="headerlink" title="创建Refs"></a>创建Refs</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  private myRef = createRef()</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> &lt;div ref=&#123;this.myRef&#125; /&gt;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>组件这样定义会收到一个编译报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[ts]</div><div class="line">Type &apos;RefObject&lt;&#123;&#125;&gt;&apos; is not assignable to type &apos;RefObject&lt;HTMLDivElement&gt;&apos;.</div></pre></td></tr></table></figure></p>
<p>为什么会出现这个报错呢，ts在jsx文件中有着非常优秀的类型推断，我们在一个<code>&lt;div&gt;</code>上增加了ref，ts就推断出需要使用HTMLDivElement类型进行接收，我们可以通过下面的写法解决这个问题。我们先看一下对React.createRef的定义：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// react.d.ts</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createRef</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span>): <span class="title">RefObject</span>&lt;<span class="title">T</span>&gt;</span></div><div class="line"><span class="function"></span></div><div class="line"><span class="function">// <span class="title">react</span>.<span class="title">d</span>.<span class="title">ts</span></span></div><div class="line"><span class="function"><span class="title">interface</span> <span class="title">RefObject</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">  <span class="comment">// immutable</span></div><div class="line">  readonly current: T | <span class="literal">null</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>返回的<code>RefObject&lt;T&gt;</code>是泛型；由此我们就可以知道怎么解决上述验证报错的问题了：<br><img src="http://static.zhyjor.com/blog/2020-04-18-151348.jpg" alt=""></p>
<h2 id="使用Refs"><a href="#使用Refs" class="headerlink" title="使用Refs"></a>使用Refs</h2><p>我们可以直接通过定义在ref上的current属性来访问这个node，如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> node = <span class="keyword">this</span>.myRef.current</div></pre></td></tr></table></figure></p>
<p>但是呢，这个node可能是null，所以我们在使用这个值来进行一些操作的时候，使用下面的代码是不行的，会收到ts的报错：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  private myRef = React.createRef&lt;HTMLDivElement&gt;()</div><div class="line">  focus() &#123;</div><div class="line">    <span class="keyword">const</span> node = <span class="keyword">this</span>.myRef.current</div><div class="line">    node.focus()</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">[ts] <span class="built_in">Object</span> is possibly <span class="string">'null'</span>.</div><div class="line"><span class="keyword">const</span> node: HTMLDivElement | <span class="literal">null</span></div></pre></td></tr></table></figure></p>
<p>我们先看一下React文档是怎么定义current的：</p>
<blockquote>
<p>React will assign the current property with the DOM element when the component mounts, and assign it back to null when it unmounts. ref updates happen before componentDidMount or componentDidUpdate lifecycle hooks.<br>当组件挂载componentDidMount时，React会将dom节点赋值给current，而当componentDidUpdate时，current的值被修改为null；</p>
</blockquote>
<p>这就是ts想通过编译错误想提醒你的信息，你需要进行一些安全措施，使用<code>if</code>进行非空判断时必要的，以保证程序不会出现运行时错误；<br><img src="http://static.zhyjor.com/blog/2020-04-18-153750.jpg" alt=""></p>
<p>这样我们就得到了HTMLDivElement DOM api的自动提醒，还是很香的<br><img src="http://static.zhyjor.com/blog/2020-04-18-0_gzeeS5C5h2tBDbv4.gif" alt=""></p>
<h3 id="给自定义Class组件添加Ref"><a href="#给自定义Class组件添加Ref" class="headerlink" title="给自定义Class组件添加Ref"></a>给自定义Class组件添加Ref</h3><p>和上面的栗子类似，我们如果想在挂载自定义组件的时候就获取焦点，我们可以通过ref访问到自定义组件的实例，调用组件的focus方法，就可以实现：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; createRef, Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoFocusTextInput</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="comment">// create ref with explicit generic parameter </span></div><div class="line">  <span class="comment">// this time instance of MyComponent</span></div><div class="line">  private myCmp = createRef&lt;MyComponent&gt;()</div><div class="line">  componentDidMount() &#123;</div><div class="line">    <span class="comment">// @FIXME</span></div><div class="line">    <span class="comment">// non null assertion used, extract this logic to method!</span></div><div class="line">    <span class="keyword">this</span>.textInput.current!.focus()</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> &lt;MyComponent ref=&#123;this.textInput&#125; /&gt;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>⚠️</p>
<ul>
<li>这种方式仅仅适用于声明为class的自定义组件</li>
<li>我们可以访问所有的实例方法</li>
</ul>
<p><img src="http://static.zhyjor.com/blog/2020-04-23-114502.jpg" alt=""></p>
<p>是不是很优雅🔥</p>
<h3 id="Refs和函数组件"><a href="#Refs和函数组件" class="headerlink" title="Refs和函数组件"></a>Refs和函数组件</h3><blockquote>
<p>因为函数组件没有实例，你可能不会在函数组件上使用ref属性；但是当你在函数组件内部的时候，还是可以通过ref来访问Dom节点或class组件的</p>
</blockquote>
<p><img src="http://static.zhyjor.com/blog/2020-04-23-120025.jpg" alt=""></p>
<h2 id="Forwarding-Refs"><a href="#Forwarding-Refs" class="headerlink" title="Forwarding Refs"></a>Forwarding Refs</h2><blockquote>
<p>Ref forwarding是一种将ref钩子自动传递给组件的子孙组件的技术</p>
</blockquote>
<h3 id="传递refs到DOM-components"><a href="#传递refs到DOM-components" class="headerlink" title="传递refs到DOM components"></a>传递refs到DOM components</h3><p>定义一个FancyButton组件，渲染一个原生的button到页面上<br><img src="http://static.zhyjor.com/blog/2020-04-23-122405.jpg" alt=""></p>
<blockquote>
<p>Ref forwarding是组件一个可选的的特性。它可以接受上层组件传递下来的ref，然后传递给自己的子组件。</p>
</blockquote>
<p>在下面的例子中，我们给组件加上Forwarding Refs，这样在必要的时候我们就可以通过ref直接访问这个组件内的button节点，就像我们直接使用button节点一样<br><img src="http://static.zhyjor.com/blog/2020-04-23-122952.jpg" alt=""></p>
<p>这里到底是什么实现的呢？</p>
<ul>
<li>我们创建并export一个Ref类型给我们组件的调用方</li>
<li>使用forwardRef，我们获取到ref，并传递给子组件，这是一个包含两个参数的普通函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// react.d.ts</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">forwardRef</span>&lt;<span class="title">T</span>, <span class="title">P</span> = </span>&#123;&#125;&gt;(</div><div class="line">  Component: RefForwardingComponent&lt;T, P&gt;</div><div class="line">): ComponentType&lt;P &amp; ClassAttributes&lt;T&gt;&gt;</div><div class="line"></div><div class="line"><span class="comment">// 这里的T，P</span></div><div class="line"><span class="number">1</span>:T是DOM的类型</div><div class="line"><span class="number">2</span>:P是传递的Props</div><div class="line"><span class="number">3</span>:返回值的定义是混合了props值和ref类型的组件的定义</div></pre></td></tr></table></figure>
<p>这样我们就可以类型安全的调用了：<br><img src="http://static.zhyjor.com/blog/2020-04-23-0_OWdwypfLrHqpjoq2.gif" alt=""></p>
<h3 id="高阶组件中使用Forwarding-refs"><a href="#高阶组件中使用Forwarding-refs" class="headerlink" title="高阶组件中使用Forwarding refs"></a>高阶组件中使用Forwarding refs</h3><p><a href="https://reactjs.org/docs/forwarding-refs.html#forwarding-refs-in-higher-order-components" target="_blank" rel="external">官方文档</a>关于高阶组件使用Forwarding refs的方式还是比较复杂的;简答来说，我们只要用forwardRef API包一层你的组件就好了<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &lt;LogProps &#123;...props&#125; forwardedRef=&#123;ref&#125; /&gt;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>下面是class组件方式实现的FancyButton<br><img src="http://static.zhyjor.com/blog/2020-04-24-020526.jpg" alt=""><br>这是我们想要如何使用这个组件<br><img src="http://static.zhyjor.com/blog/2020-04-24-020706.jpg" alt=""></p>
<p>最后，我们通过ref forwarding实现这个高阶组件<br><img src="http://static.zhyjor.com/blog/2020-04-24-023935.jpg" alt=""></p>
<p>使用ref forwarding的高阶组件需要我们明确参数类型<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> EnhancedFancyButton = withPropsLogger&lt;</div><div class="line">  FancyButton, </div><div class="line">  FancyButtonProps</div><div class="line">&gt;(FancyButton)</div></pre></td></tr></table></figure></p>
<p>这样我们就可以类型安全的使用了<br><img src="http://static.zhyjor.com/blog/2020-04-24-0_Rkp7RYK65NVE8-YB.gif" alt=""></p>
<p>以上！<br>最后的惯例，贴上<a href="https://github.com/zhyjor/homepage-index" target="_blank" rel="external">我的博客</a>，欢迎关注</p>
<p><strong>参考资料</strong><br><a href="https://medium.com/@martin_hotell/react-refs-with-typescript-a32d56c4d315" target="_blank" rel="external">React Refs with TypeScript</a><br><a href="https://create-react-app.dev/docs/adding-typescript/" target="_blank" rel="external">Adding TypeScript</a><br><a href="http://doc.codingdict.com/react-cn-doc/docs/refs-and-the-dom/" target="_blank" rel="external">何时使用 Refs(官方文档)</a></p>
<p><img src="https://static.zhyjor.com/wexin.png" alt=""></p>

      
    </div>

	<div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <p><span>本文标题:</span><a href="/2020/04/18/ReactRefs如何使用TypeScript/">【译】React Refs中使用TypeScript</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 zhyjor 的个人博客">zhyjor</a></p>
  <p><span>发布时间:</span>2020年04月18日 - 11:04</p>
  <p><span>最后更新:</span>2023年10月11日 - 02:10</p>
  <p><span>原始链接:</span><a href="/2020/04/18/ReactRefs如何使用TypeScript/" title="【译】React Refs中使用TypeScript">https://zhyjor.github.io/2020/04/18/ReactRefs如何使用TypeScript/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://zhyjor.github.io/2020/04/18/ReactRefs如何使用TypeScript/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
	clipboard.on('success', $(function(){
	  $(".fa-clipboard").click(function(){
		swal({   
		  title: "",   
		  text: '复制成功',   
		  html: false,
		  timer: 500,   
		  showConfirmButton: false
	    });
	  });
    }));  
</script>

      
	</div>
	
    <div>
      
        

      
    </div>
  
        <div class="post-tags">
          
            <a href="/tags/前端/" rel="tag"># 前端</a>
          
            <a href="/tags/react/" rel="tag"># react</a>
          
        </div>
      


    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>🐶 您的支持将鼓励我继续创作 🐶</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赞赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat-reward-img.jpg" alt="zhyjor WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay-reward-img.jpg" alt="zhyjor Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
         
      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/08/写更优雅的react代码之一：利用工具/" rel="next" title="写更优雅的react代码之一：利用工具">
                <i class="fa fa-chevron-left"></i> 写更优雅的react代码之一：利用工具
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/05/01/重构与改善之一：阅读笔记/" rel="prev" title="重构与改善之一：阅读笔记">
                重构与改善之一：阅读笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="monthly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMTE5Ny83NzQ2"></div>
	
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="zhyjor" />
          <p class="site-author-name" itemprop="name">zhyjor</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">336</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">62</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">182</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhyjor" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/zhyjor" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/zhyjor" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-battery-3"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.woaitqs.cc/" title="Qisen Tang" target="_blank">Qisen Tang</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://szhshp.org" title="szhshp的博客" target="_blank">szhshp的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://python.zhangwei.website" title="JuniorCoder" target="_blank">JuniorCoder</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://hippo-jessy.com" title="Hippo" target="_blank">Hippo</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.zhihu.com/people/lippi-ouyang" title="友链出租" target="_blank">友链出租</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是Refs"><span class="nav-number">1.</span> <span class="nav-text">什么是Refs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建Refs"><span class="nav-number">2.</span> <span class="nav-text">创建Refs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用Refs"><span class="nav-number">3.</span> <span class="nav-text">使用Refs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#给自定义Class组件添加Ref"><span class="nav-number">3.1.</span> <span class="nav-text">给自定义Class组件添加Ref</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Refs和函数组件"><span class="nav-number">3.2.</span> <span class="nav-text">Refs和函数组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Forwarding-Refs"><span class="nav-number">4.</span> <span class="nav-text">Forwarding Refs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#传递refs到DOM-components"><span class="nav-number">4.1.</span> <span class="nav-text">传递refs到DOM components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#高阶组件中使用Forwarding-refs"><span class="nav-number">4.2.</span> <span class="nav-text">高阶组件中使用Forwarding refs</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhyjor</span>
</div>



<!--
<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>
-->

<div class="powered-by">
<i class="fa fa-user-md"></i>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</div>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共338.7k字</span>
</div>





        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ezlippi"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="//cdn.jsdelivr.net/ua-parser.js/0.7.10/ua-parser.min.js"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  














  
  

  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
<div id="hexo-helper-live2d">
  <canvas id="live2dcanvas" width="150" height="300"></canvas>
</div>
<style>
  #live2dcanvas{
    position: fixed;
    width: 150px;
    height: 300px;
    opacity:0.7;
    right: 0px;
    z-index: 999;
    pointer-events: none;
    bottom: -20px;
  }
</style>
<script type="text/javascript" src="/live2d/device.min.js"></script>
<script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    document.getElementById("live2dcanvas").style.width = '75px';
    document.getElementById("live2dcanvas").style.height = '150px';
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/tororo.model.json", 0.5);});
})();
</script>

<style>
#live2dcanvas{
  position: fixed;
	bottom: 0px;
	left: 0px;
	z-index: 999;
	width: 150px;
	height: 300px;
  pointer-events: none;
  opacity: 1;
}
</style>
</body>
</html>
